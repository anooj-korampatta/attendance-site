<!--
SETUP:
1) Replace API_BASE with your Apps Script Web App URL (ending with /exec)
2) Commit this file
3) Enable GitHub Pages (Step 3 below)
4) Author: Anooj Korampatta
-->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Townhall Check-In</title>
  <style>
    :root { --ink:#0f172a; --muted:#64748b; --bg:#f6f7fb; --card:#fff; }
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    .wrap{max-width:480px;margin:40px auto;padding:0 16px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 10px 25px rgba(2,8,20,.06);padding:24px}
    h1{margin:0 0 6px;font-size:22px;text-align:center}
    p.muted{text-align:center;margin:6px 0 20px;color:var(--muted)}
    input[type=tel]{width:100%;padding:14px;border-radius:12px;border:1px solid #e2e8f0;font-size:18px;margin-bottom:10px}
    input[type=tel]:focus{border-color:#3b82f6}
    button{padding:14px;border:0;border-radius:12px;font-weight:600;font-size:16px;cursor:pointer;width:100%;margin-top:10px;background:#0ea5e9;color:#fff}
    button.ok{background:#10b981}
    button.warn{background:#f59e0b}
    .msg{margin-top:10px;padding:12px;border-radius:10px;font-size:15px;display:none}
    .msg.ok{background:#ecfeff;color:#155e75;display:block}
    .msg.err{background:#fee2e2;color:#7f1d1d;display:block}
    .hiBox{text-align:center;font-size:20px;margin-top:20px;font-weight:600}
    .footer{text-align:center;margin-top:25px;color:#94a3b8;font-size:12px}
    .hide{display:none}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Townhall Attendance</h1>
      <p class="muted">Enter your mobile number</p>

      <input id="empId" type="tel" inputmode="numeric" placeholder="Mobile number">

      <button onclick="fetchDetails()">Fetch</button>

      <div id="msg"></div>

      <!-- Simple greeting -->
      <div id="hiBox" class="hiBox hide"></div>

      <!-- Buttons -->
      <button id="btnIn"  class="ok hide"  onclick="doCheck('checkin')">Check In</button>
      <button id="btnOut" class="warn hide" onclick="doCheck('checkout')">Check Out</button>

      <div id="summary" class="muted" style="margin-top:20px;text-align:center"></div>
    </div>
    <div class="footer">Powered by Google Sheets</div>
  </div>


<script>
  // <<< REPLACE WITH YOUR EXEC URL >>>
  const API_BASE = "YOUR_GAS_EXEC_URL_HERE";

  function showMsg(text, ok){
    const m = document.getElementById("msg");
    if(!text){ m.style.display='none'; return; }
    m.className = ok ? "msg ok" : "msg err";
    m.textContent = text;
    m.style.display = "block";
  }

  function resetUI(){
    showMsg('', true);
    document.getElementById("hiBox").classList.add("hide");
    document.getElementById("btnIn").classList.add("hide");
    document.getElementById("btnOut").classList.add("hide");
  }

  function paint(emp){
    // Simple greeting
    const hi = document.getElementById("hiBox");
    hi.textContent = `Hi ${emp.name} ðŸ‘‹ Please continue`;
    hi.classList.remove("hide");

    // Show buttons
    document.getElementById("btnIn").classList.remove("hide");
    document.getElementById("btnOut").classList.remove("hide");
  }

  async function fetchJSON(url){
    const res = await fetch(url);
    return res.json();
  }

  async function fetchDetails(){
    resetUI();
    const id = document.getElementById("empId").value.trim();
    if(!id){ return showMsg("Please enter mobile number", false); }

    try{
      const data = await fetchJSON(`${API_BASE}?action=lookup&id=${encodeURIComponent(id)}`);
      if(!data.ok) return showMsg(data.error || "Lookup failed", false);

      paint(data.employee);
      showMsg('', true);
      refreshSummary();

    }catch(e){
      showMsg("Lookup failed.", false);
    }
  }

  async function doCheck(kind){
    const id = document.getElementById("empId").value.trim();
    if(!id){ return showMsg("Enter mobile number", false); }

    try{
      const data = await fetchJSON(`${API_BASE}?action=${kind}&id=${encodeURIComponent(id)}`);
      if(!data.ok) return showMsg(data.error || "Failed", false);

      if(data.already){
        showMsg(data.message, true);
      } else {
        showMsg(kind === "checkin" ? "Checked In!" : "Checked Out!", true);
      }

      if(data.employee) paint(data.employee);
      refreshSummary();

    }catch(e){
      showMsg("Failed.", false);
    }
  }

  async function refreshSummary(){
    try{
      const d = await fetchJSON(`${API_BASE}?action=summary`);
      if(d.ok){
        document.getElementById("summary").textContent =
          `Total: ${d.total} | IN: ${d.inCount} | OUT: ${d.outCount}`;
      }
    }catch(e){}
  }

  window.onload = () => {
    document.getElementById("empId").focus();
    refreshSummary();
  };
</script>

</body>
</html>

